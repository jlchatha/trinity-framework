# Trinity Framework Compliance Check
#
# Optional workflow to verify protocol files exist and are properly structured.
# Add this to your agent workspace repository to catch issues early.
#
# To use: Copy this file to your workspace's .github/workflows/ directory

name: Trinity Compliance

on:
  push:
    paths:
      - 'AGENT.md'
      - 'CLAUDE.md'
      - 'STATUS.md'
      - 'AUTO-COMPACT.md'
  pull_request:
    paths:
      - 'AGENT.md'
      - 'CLAUDE.md'
      - 'STATUS.md'
      - 'AUTO-COMPACT.md'

jobs:
  check-protocol-files:
    runs-on: ubuntu-latest
    name: Check Protocol Files

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check AGENT.md exists
        run: |
          if [ ! -f "AGENT.md" ]; then
            echo "::error::AGENT.md not found"
            exit 1
          fi
          echo "✓ AGENT.md exists"

      - name: Check STATUS.md exists
        run: |
          if [ ! -f "STATUS.md" ]; then
            echo "::error::STATUS.md not found"
            exit 1
          fi
          echo "✓ STATUS.md exists"

      - name: Check AUTO-COMPACT.md exists
        run: |
          if [ ! -f "AUTO-COMPACT.md" ]; then
            echo "::error::AUTO-COMPACT.md not found"
            exit 1
          fi
          echo "✓ AUTO-COMPACT.md exists"

      - name: Validate AGENT.md structure
        run: |
          # Check for required sections
          if ! grep -q "## IDENTITY" AGENT.md && ! grep -q "## Identity" AGENT.md; then
            echo "::warning::AGENT.md missing Identity section"
          fi
          if ! grep -q "## RECOVERY" AGENT.md && ! grep -q "## Recovery" AGENT.md; then
            echo "::warning::AGENT.md missing Recovery section"
          fi
          echo "✓ AGENT.md structure validated"

      - name: Validate STATUS.md structure
        run: |
          # Check for priority section
          if ! grep -q "## Current Priority" STATUS.md && ! grep -q "## Priority" STATUS.md; then
            echo "::warning::STATUS.md missing Priority section"
          fi
          echo "✓ STATUS.md structure validated"

      - name: Validate AUTO-COMPACT.md structure
        run: |
          # Check for recovery state
          if ! grep -q "## Last Working State" AUTO-COMPACT.md && ! grep -q "## Recovery" AUTO-COMPACT.md; then
            echo "::warning::AUTO-COMPACT.md missing Last Working State section"
          fi
          echo "✓ AUTO-COMPACT.md structure validated"

      - name: Summary
        run: |
          echo "## Trinity Compliance Check Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "All protocol files present and validated." >> $GITHUB_STEP_SUMMARY
